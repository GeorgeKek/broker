var tooltip={init:function(){this.getTooltips(),this.api.init(),setTimeout(()=>{this.pretifyTerms(),this.setTermsInText()},1e3)},terms:{},newTerms:{},testUrl:"https://pre-prod.iticapital.ru/",baseUrl:"https://iticapital.ru/",openDescr:function(){tippy("._tooltip",{trigger:"click"})},sendAjax:function(e){var t=new("onload"in new XMLHttpRequest?XMLHttpRequest:XDomainRequest);if(t.open(e.method,e.url,!0),"undefined"!=e.headers)for(var o in e.headers)t.setRequestHeader(o,e.headers[o]);t.onload=function(t){"function"==typeof e.success&&e.success(t)},t.onerror=function(t){"function"==typeof e.error&&e.error(t)},void 0!==e.data?t.send(JSON.stringify(e.data)):t.send()},getTooltips:function(){this.sendAjax({url:this.baseUrl+"widget-constructor/getallterm/",method:"get",success:function(t){tooltip.terms=JSON.parse(t.currentTarget.response).result,tooltip.openByUrl()},error:function(t){console.log("ошибка при получении виджетов",t)}})},openByUrl:function(){for(var t=Object.keys(tooltip.terms),e=0;e<t.length;e++){var o=t[e];if(tooltip.terms[o].activeUrl&&tooltip.terms[o].activeUrl==window.location.pathname){this.showForm(o);break}}},api:{baseUrl:"https://iticapital.ru/apicrm-test/",baseHeadersUrl:"https://iticapital.ru/api-entrance/getkey/",token:null,init:function(){var t=tooltip.cookie.getCookie("it-checkstr");void 0===t?this.setHeaders():this.token=t,setInterval(function(){tooltip.api.setHeaders()},36e5)},setHeaders:function(t){tooltip.sendAjax({url:this.baseHeadersUrl,method:"get",success:function(t){t=JSON.parse(t.srcElement.response);"true"==t.success&&(tooltip.cookie.setCookie("it-checkstr",t.output["it-checkstr"],{expires:86400,path:"/"}),tooltip.cookie.setCookie("it-entry",t.output["it-entry"],{expires:86400,path:"/"}))},error:function(t){JSON.parse(t.srcElement.response).status&&$("body").addClass("api-error")}})},getHeader:function(){var t=tooltip.cookie.getCookie("it-checkstr"),e=tooltip.cookie.getCookie("it-entry"),o="";try{o=t.split("q").filter(Boolean).map(function(t){return String.fromCharCode(parseInt(t)^e)}).join("")}catch(t){o=null}return o}},cookie:{getCookie:function(t){t=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},setCookie:function(t,e,o){selectionOptions=o||{};var i,r=o.expires;"number"==typeof r&&r&&((i=new Date).setTime(i.getTime()+1e3*r),r=o.expires=i),r&&r.toUTCString&&(o.expires=r.toUTCString());var s,n=t+"="+(e=encodeURIComponent(e));for(s in o){n+="; "+s;var a=o[s];!0!==a&&(n+="="+a)}document.cookie=n}},pretifyTerms:function(){if(void 0!==tooltip.terms&&Object.keys(tooltip.terms).length){let o={};Object.values(tooltip.terms).forEach(t=>{var e=JSON.parse(t.settings);o[e.title]={...t,...e}}),tooltip.newTerms=o}},setTermsInText:function(){for(var[t,o]of Object.entries(tooltip.newTerms)){var i,r=document.querySelector(".visual-editor"),s=`${o.title}`;let e=`${o.description}`;i={element:"span",className:"term _tooltip",separateWordSearch:!1,accuracy:{value:"exactly",limiters:[",",".",")","("]},each:function(t){$(t).attr("data-tippy-content",e)}};let t=new Mark(r);t.mark(s,i)}tooltip.openDescr()}};tooltip.init();