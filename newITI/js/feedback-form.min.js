"use strict";$(document).ready(function(){feedbackForm.init()});var feedbackForm={init:function(){this.formsValidation.init(),$(".feedback-form-select").niceSelect(),this.initRequiredSelects(),this.dadata.init(),this.contractInput(),this.indexInput(),this.onlyLetters(),this.uploadDocs.init()},initRequiredSelects:function(){$(".feedback-form-select_required").on("change",function(){$(this).valid()})},contractInput:function(){$("._contract").inputmask({mask:"BP 9{4,5}",defaultValue:"BP ",showMaskOnHover:!1,placeholder:""})},indexInput:function(){$("._index").inputmask({mask:"9{5,6}",showMaskOnHover:!1,placeholder:""})},onlyLetters:function(){$("._only-letters").on("input",function(e){var a=/[^a-zA-Zа-яА-ЯёЁ\—\–\−\-\s]/g;$(this).val().match(a)&&$(this).val($(this).val().replace(a,""))})},toogleAddress:function(e){$(e).prop("checked")?$(".feedback-address-wr").slideDown(300,function(){feedbackForm.formsValidation.checkFormState("#feedback-form")}):$(".feedback-address-wr").slideUp(300,function(){feedbackForm.formsValidation.checkFormState("#feedback-form")})},sendForm:function(e,a){if(a.preventDefault(),!$(e).valid())return!1;$(e).find('button[type="submit"]').addClass("btn_loader"),$(e).parents(".feedback-form-box").addClass("feedback-form-box_sendeding");e=$(e)[0],e=new FormData(e);$.ajax({type:"POST",url:"",data:e,enctype:"multipart/form-data",processData:!1,contentType:!1,cache:!1,success:function(e){$(".feedback-form-box_sendeding").removeClass("feedback-form-box_sendeding").addClass("feedback-form-box_sended"),$(".feedback-succees-wr").slideDown(200,function(){$("html, body").animate({scrollTop:$(".feedback-success__header").offset().top+$(".feedback-succees-wr").height()/2-$(window).height()/2},200)}),$(".btn_loader").removeClass("btn_loader")}})},uploadDocs:{init:function(){$(".feedback-form-wr").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}),$(".feedback-form-wr").on("dragleave dragend drop",function(e){return!!$(".feedback-drop-wr").hasClass("feedback-drop-wr_hover")&&($(".feedback-drop-wr").removeClass("feedback-drop-wr_hover"),void $(".feedback-drop-label").removeClass("feedback-drop-label_hover"))}),$(".feedback-form-wr").on("dragover dragenter",function(e){return!$(".feedback-drop-wr").hasClass("feedback-drop-wr_hover")&&($(".feedback-drop-wr").addClass("feedback-drop-wr_hover"),void $(".feedback-drop-label").addClass("feedback-drop-label_hover"))}),$(".feedback-drop-wr, .feedback-drop-label").on("drop",function(e){if(e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length){for(var a=[],d=0;d<e.originalEvent.dataTransfer.files.length;d++)e.originalEvent.dataTransfer.files[d].type&&a.push(e.originalEvent.dataTransfer.files[d]);a.length&&($(".feedback-files")[0].files=a,feedbackForm.uploadDocs.upload(a))}})},num2str:function(e,a){var d=(e=Math.abs(e)%100)%10;return 10<e&&e<20?a[2]:1<d&&d<5?a[1]:1==d?a[0]:a[2]},checkFileSize:function(e){for(var a=0,d=0;d<e.length;d++)a+=e[d].size;return 20480<=a/1024?($(".feedback-added-wr").addClass("large-file"),$(".feedback-added-name").text("Размер файлов больше 20 МБ"),$(".feedback-drop-tooltip").addClass("feedback-drop-tooltip_left").html("Попробуйте архивировать или используйте облачное хранилище и&nbsp;прикрепите ссылку"),$(".feedback-file__tooltip").text("Размер файлов больше 20 МБ"),$(".feedback-files").val(""),$(".feedback-file__tooltip_mobile").addClass("feedback-file__tooltip_error"),$(".feedback-file__error-descr").slideDown(200),!1):($(".feedback-drop-tooltip").html("Размер файлов — не больше 20 МБ. Формат любой"),$(".feedback-file__tooltip").html("Размер файлов — не больше 20 МБ. <br /> Формат любой"),$(".feedback-added-wr").removeClass("large-file"),$(".feedback-file__tooltip_mobile").removeClass("feedback-file__tooltip_error"),$(".feedback-file__error-descr").slideUp(200),!0)},checkFileSizeNewFile:function(e){for(var a=0,d=0;d<e.length;d++)a+=e[d].size;return 5120<=a/1024?($(".feedback-form-group__item--file").find(".feedback-added-wr").addClass("large-file"),$(".feedback-form-group__item--file").find(".feedback-added-name").text("Размер файлов больше 5 МБ"),$(".feedback-form-group__item--file").find(".feedback-drop-tooltip").addClass("feedback-drop-tooltip_left").html("Попробуйте архивировать или используйте облачное хранилище и&nbsp;прикрепите ссылку"),$(".feedback-form-group__item--file").find(".feedback-file__tooltip").hide(),$(".feedback-form-group__item--file").find(".feedback-files").val(""),$(".feedback-form-group__item--file").find(".feedback-file__tooltip_mobile").addClass("feedback-file__tooltip_error"),$(".feedback-form-group__item--file").find(".feedback-file__error-descr").slideDown(200),!1):($(".feedback-form-group__item--file").find(".feedback-added-wr").removeClass("large-file"),$(".feedback-form-group__item--file").find(".feedback-file__tooltip").hide(),$(".feedback-form-group__item--file").find(".feedback-file__tooltip_mobile").removeClass("feedback-file__tooltip_error"),$(".feedback-form-group__item--file").find(".feedback-file__error-descr").slideUp(200),!0)},checkFileSizeNewResume:function(e){for(var a=0,d=0;d<e.length;d++)a+=e[d].size;return 5120<=a/1024?($(".feedback-form-group__item--resume").find(".feedback-added-wr").addClass("large-file"),$(".feedback-form-group__item--resume").find(".feedback-added-name").text("Размер файлов больше 5 МБ"),$(".feedback-form-group__item--resume").find(".feedback-drop-tooltip").addClass("feedback-drop-tooltip_left").html("Попробуйте архивировать или используйте облачное хранилище и&nbsp;прикрепите ссылку"),$(".feedback-form-group__item--resume").find(".feedback-file__tooltip").hide(),$(".feedback-form-group__item--resume").find(".feedback-files").val(""),$(".feedback-form-group__item--resume").find(".feedback-file__tooltip_mobile").addClass("feedback-file__tooltip_error"),$(".feedback-form-group__item--resume").find(".feedback-file__error-descr").slideDown(200),!1):($(".feedback-form-group__item--resume").find(".feedback-added-wr").removeClass("large-file"),$(".feedback-form-group__item--resume").find(".feedback-file__tooltip").hide(),$(".feedback-form-group__item--resume").find(".feedback-file__tooltip_mobile").removeClass("feedback-file__tooltip_error"),$(".feedback-form-group__item--resume").find(".feedback-file__error-descr").slideUp(200),!0)},setFileName:function(e){if(!e.length)return!1;var a=e[0].name;if(1<e.length)return a="Прикреплено "+e.length+" "+this.num2str(e.length,["файл","файла","файлов"]),$(".feedback-added-name").text(a),!1;35<=a.length&&(e="..."+a.split(".").pop(),a=a.substr(0,30)+e),$(".feedback-added-name").text(a)},setFileNameNewResume:function(e){if(!e.length)return!1;var a=e[0].name;if(1<e.length)return a="Прикреплено "+e.length+" "+this.num2str(e.length,["файл","файла","файлов"]),$(".feedback-form-group__item--file").find(".feedback-added-name").text(a),!1;35<=a.length&&(e="..."+a.split(".").pop(),a=a.substr(0,30)+e),$(".feedback-form-group__item--resume").find(".feedback-added-name").text(a)},setFileNameNewFile:function(e){if(!e.length)return!1;var a=e[0].name;if(1<e.length)return a="Прикреплено "+e.length+" "+this.num2str(e.length,["файл","файла","файлов"]),$(".feedback-form-group__item--file").find(".feedback-added-name").text(a),!1;35<=a.length&&(e="..."+a.split(".").pop(),a=a.substr(0,30)+e),$(".feedback-form-group__item--file").find(".feedback-added-name").text(a)},upload:function(e){if(!(e=void 0!==$(e)[0].files?$(e)[0].files:e).length)return!1;this.checkFileSize(e)&&this.setFileName(e),$(".feedback-drop-label").hide(),$(".feedback-added-wr").css("display","flex").fadeIn(200)},uploadNewFile:function(e){if(1!=(e=void 0!==$(e)[0].files?$(e)[0].files:e).length)return!1;this.checkFileSizeNewFile(e)&&this.setFileNameNewFile(e),$(".feedback-form-group__item--file").find(".feedback-added-wr").css("display","flex").fadeIn(200)},uploadNewResume:function(e){if(1!=(e=void 0!==$(e)[0].files?$(e)[0].files:e).length)return!1;this.checkFileSizeNewResume(e)&&this.setFileNameNewResume(e),$(".feedback-form-group__item--resume").find(".feedback-added-wr").css("display","flex").fadeIn(200)},clearFiles:function(){$(".feedback-drop-label").css("display","flex").fadeIn(200),$(".feedback-added-wr").hide(),$(".feedback-drop-tooltip").html("Размер файлов — не больше 20 МБ. Формат любой"),$(".feedback-added-wr").removeClass("large-file"),$("input.feedback-files").val("")},clearFilesNewResume:function(){$(".feedback-form-group__item--resume").find(".feedback-added-wr").hide(),$(".feedback-form-group__item--resume").find(".feedback-file__tooltip").show(),$(".feedback-form-group__item--resume").find(".feedback-added-wr").removeClass("large-file"),$(".feedback-form-group__item--resume").find("input.feedback-files").val("")},clearFilesNewFile:function(){$(".feedback-form-group__item--file").find(".feedback-added-wr").hide(),$(".feedback-form-group__item--file").find(".feedback-file__tooltip").show(),$(".feedback-form-group__item--file").find(".feedback-added-wr").removeClass("large-file"),$(".feedback-form-group__item--file").find("input.feedback-files").val("")}},formsValidation:{init:function(){this.feedbackFomrValidation(),this.addNewRules()},addNewRules:function(){$("._required").each(function(){$(this).rules("add",{required:!0,normalizer:function(e){return $.trim(e)},messages:{required:"Заполните это поле"}})}),$.validator.messages.required="Заполните это поле",$.validator.addMethod("inputmask",function(e,a){return $(a).inputmask("isComplete")},"Неверный формат")},rules:{email:{required:!0,email:!0},contract:{required:!0,inputmask:!0},index:{required:!0,inputmask:!0},checkbox:{required:!0},"address-subject":{required:!0}},messages:{email:{required:"Заполните это поле",email:"Неверный формат"},contract:{required:"Заполните это поле",inputmask:"Неверный формат"},checkbox:{required:"Заполните это поле"},"address-subject":{required:"Выберите тему обращения"}},feedbackFomrValidation:function(){this.changeSubmitBtnState("#feedback-form"),$("#feedback-form").validate({errorPlacement:function(e,a){return $(a).parent().addClass("input-wr_error"),$(a).siblings(".input__err-label").text(e.text()),$(a).parent().removeClass("input-wr_valid"),!1},unhighlight:function(e){$(e).removeClass("error"),$(e).parent().removeClass("input-wr_error"),$(e).val()?$(e).parent().addClass("input-wr_valid"):$(e).parent().removeClass("input-wr_valid")},onfocusout:function(d){var e=$(d).parents("form").find("input, textarea, select");$(e).each(function(e,a){if($(a).valid(),d==a)return!1})},onkeyup:!1,ignoreTitle:"true",ignore:":hidden:not(.feedback-form-select_required)",errorElement:"none",rules:this.rules,messages:this.messages})},checkFormState:function(e){var a=$(e).find('button[type="submit"]');$(e).validate().checkForm()?$(a).removeClass("btn-submit_disabled"):$(a).addClass("btn-submit_disabled")},changeSubmitBtnState:function(e){$(e).on("blur keyup change","input, textarea",function(e){feedbackForm.formsValidation.checkFormState($(this).parents("form"))})}},dadata:{token:"de5d7935de9a90b23663a28ed11b656ba7618e4b",init:function(){void 0!==window.token&&(this.token=window.token),this.dadataName(),this.dadataAddress()},getSettingsDadata:function(e){try{var a=e.attributes,d=a["hint-part"].value,t=a["dadata-type"].value.toUpperCase();if(""==t)return!1;var r={token:feedbackForm.dadata.token,type:t,count:5,constraints:{locations:{country:"*"}},triggerSelectOnBlur:!1,mobileWidth:0,hint:!1};return"ADDRESS"==t&&d&&(r.bounds=d),"NAME"==t&&d&&(r.params={parts:[d.toUpperCase()]}),r}catch(e){return!1}},dadataName:function(){$(".dadata-input-name").each(function(e,a){var d=feedbackForm.dadata.getSettingsDadata(a);$(a).suggestions(d)})},dadataAddress:function(){$(".dadata-input-address-gran").each(function(e,a){var d=feedbackForm.dadata.getSettingsDadata(a);$(a).attr("contrains-type")&&(d.constraints=$('.dadata-input-address-gran[hint-part="'+$(a).attr("contrains-type")+'"]')),d.onSelect=function(d,e,a,t){$(".dadata-input-address-gran").each(function(e,a){null!=d.data.postal_code&&$(a).val(d.data[$(a).attr("hint-part")]),$(a).hasClass("_index")||$(a).hasClass("_country")||($(a).suggestions().setSuggestion(d),$(a).val()&&$(a).valid())})},d.formatSelected=function(e,a){null!=e.data.postal_code&&void 0!==e.data.postal_code||(e.data.postal_code=$("._index").val()),$("._index").valid()},$(a).suggestions(d)})}}};